---
title: UnityShade入门精要（14`基于物理的渲染）
date: 2024-12-23 12:00:00 +0800
categories: [Unity_Shader]
tags: [shader]     # TAG names should always be lowercase
math: true
---
# 基于物理的渲染
## PBR光照模型
为了更加真实的渲染效果，使用基于物理的渲染技术 (Physically Based Rendering),

一个PBR光照模型，是否基于物理的，可以根据三个特性来判断：它是否满足能量守恒 (energy conservation)表面反射的不能超过入射的光能，微平面理论（表面实际是由许多人哏看不到的微面元组成的），基于物理的BRDF

光线从发光物发射出来，经过物体的吸收和散射（反射，折射） ，传入人眼，

次表面散射SSS：诸如皮肤，蜡烛等材质，光线在折射入物体内部会再次散射或吸收，一些光会从不同于入射点的位置从物体内部再次射出，从而让物体表面的明暗过渡更加自然，小的表面细节变得看不清，往往引起微弱的倾向红色的颜色偏移，但是目前我们不会考虑SSS

## 双向反射分布函数 (BRDF)

我们通常使用辐射度量学量化光，可以把对物体入射的光线称为入射辐射功率，如果要得到出射辐射功率，用BRDF来求得，

各项同性(isotropic)材质：绕着表面法线旋转入射方向或观察方向并不会影响结果，反之各项异性(anisotropic)

BRDF：表示某方向入射 能量，经过BRDF后，向某观察方向反射多少能量

反射等式 == 出射辐射率：所有半球方向入射的能量经过BRDF反射到观察方向的能量

渲染方程（PBR光照模型）：物体自发光能量 + 所有半球方向入射的能量经过BRDF反射到观察方向的能量

对于BRDF通常分解为漫反射和镜面部分描述它

##### BRDF漫反射部分

最简单的BRDF漫反射模型——兰伯特： cdiff 漫反射颜色  / pai （假设漫反射在所有方向上的强度都是相同的）

##### BRDF镜面反射部分

D(h)是法线分布函数，有多少个微小平面，会将光线反射到人眼，即反射光线 == h半程方向

G(l,v,h)是几何函数，表示在微平面中，有多少反射光线会被遮挡，不会被看到

F菲涅尔反射 ，表示了反射光线占入射光线的比率

4(n·l)(n·v)是用于校正从微面元的局部空间到整体宏观表面数扯差异的校正因子

其中DGF又有各自的多种模型实现，比如D的GGX、 Beckmann模型等。G的Smith 模型，F的 Schlick等

## Standard Shader

幸运的是，在Unity 中我们不需要自己在shader 中实现上面的公式， Unity 已经为我们提供了现成的基于物理着色的shader, 也就是Standard Shader

Unity 支持两种基于物理的工作流（使用的参数不同，实现相同的效果），金属工作流 (Metallicwork.flow) 和高光反射工作流 (Specular work.flow)

它们都定义了两个 SubShader, 第一个SubShader 使用的计算更加复杂，主要针对非移动台），并定义了前向渲染路径和延迟渲染路径使用的 Pass, 以及用于投射阴影和提取元数据的Pass

第二个SubShader定义了 4个 Pass, 其中两个Pass用于前向渲染路径， 一个 Pass 用于投射阴影， 另一个 Pass 用于提取元数据，该 SubShader 主要针对移动平台

##### 如何使用 Standard Shader



## 复杂实例


## 反射探针