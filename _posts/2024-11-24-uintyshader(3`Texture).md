---
title: UnityShade入门精要（1·Texture）
date: 2024-11-24 12:00:00 +0800
categories: [Unity_Shader]
tags: [shader]     # TAG names should always be lowercase
math: true
---
# Texture
想要完成贴图的效果，是通过纹理映射，找到顶点对应的纹理坐标，查询纹理上对应的纹素，根据纹素的颜色设置顶点的颜色

OpenGL和DirectX在二维纹理空间中的坐标系有差异，在OpenGL里，纹理空间的原点位于左下角，而在DirectX中，原点位千左上角。Unity使用的纹理空间是符合OpenGL的传统的， 也就
是说，原点位于纹理左下

在shader中，新增纹理等属性，创建在 CG 代码片中声明和上述属性类型相匹配的变量，其中_MainTex_ST可以让我们得到该纹理的缩放和平移 （偏移）值

定义输入输出struct：TEXCOORDn(当作为顶点着色器向片段着色器传递的语义时，可以传递各种不同类型的数据，简化了shader的开发复杂度)

```v .texcoord. xy * MainTex ST. xy + MainTex ST.zw; ```

vertex shader中_MainTex_ST.xy对顶点纹理坐标进行缩放，_MainTex_ST.zw 对结果进行偏移,TRANSFORM_TEX内翌宏 来帮我们计算上述过程

fragment shader中，CG使用tex2D 函数对纹理进行采样，它的第一个参数是需要被采样的纹理，第二个参数是一个float2类型的纹理坐标，采样的颜色值作为顶点的albedo漫反射颜色值
# unity texture属性
在unity editor中，我们要正确设置纹理的属性，
* texture type
* Wrap Mode 决定了当纹理坐标超过[O, l]范围后将会如何被平铺。
  * Repeat,如果纹理坐标超过了 1 那么它的整数部分将会被舍弃，而直接使用小数部分进行采样，这样的结果是纹理将会不断重复；
  * Clamp,如果纹理坐标大千 1, 那么将会截取到 1, 如果小于O, 那么将会截取到 0。
* FilterMode指定纹理过滤模式的枚举类型（当像素和纹理分辨率不同时（需要放大纹理时），采样哪个纹素），支持 3 种模式
  *  Point点过滤（最近邻(nearest neighbor)算法），选取距离该像素中心最近的纹素，呈现出块状或像素化的外观
  *  Bilinear双线性过滤，会考虑该像素所覆盖的纹理区域周围的 4 个纹素进行加权平均计算
  *  Trilinear三线性过滤，Mipmap 级别之间进行线性插值计算
* 纹理缩小的过程比放大更加复杂一些，此时原纹理中的多个纹素将会对应一个目标像素，最常使用的方法就是使用多级渐远纹理(mipmapping)，
* 需要修改纹理类型，即可开启多级渐远纹理技术，需要使用一定的空间用于存储这些多级渐远纹理，这是一种典型的用空间换取时间的方法，并和会配合FilterMode使用
* 当我们在为不同平台发布游戏时，需要考虑目标平台的纹理尺寸和质凰问题。允许我们为不同目标平台选择不同的分辨率
  * Max Size 如果导入的纹理大小超过了设置的值，那么会把该纹理缩放为这个最大分辨率（出于性能和空间的考虑，我们应该尽量使用 2 的幕大小的纹理。）
  * Format 决定了 Unity 内部使用哪种格式来存储该纹理，纹理格式精度越高，占用的内存空间越大，但得到的效果也越好

# 凹凸映射(bumpmapping)
为了让贴图看起来更真实，渲染凹凸感，有两种方法可以做到（性能原因并不改变模型的网格）,两者通常一起使用

高度纹理 (height map) 进行高度映射，存储黑白的高度值,颜色越浅表明该位置的表面越向
外凸起，而颜色越深表明该位置越向里凹

法线纹理 (normal map)进行法线映射 ，它存储了法线的方向，对于之前一直使用的法线纹理，是定义在模型空间中（世界空间）的，但是在实际存储时，通常会使用切线空间存储法线

切线空间：每个顶点都有一个属千自己的切线空间，TBN -》切线，副切线，法线 -》xyz

比如模型空间的法线存储在贴图，通常是颜色各异，是因为对于世界坐标来说，法线方向都不同，但是对于切线空间的法线存储在贴图，通常呈现蓝色，因为法线相对于各自顶点的切线空间是方向趋近于z的

我们进行光照计算都需要保证在同一坐标系下运算， 由于法线纹理中存储的法线是切线空间下的方向，我们通常有两种选择： 
* 一种选择是在切线空间下进行光照计算，效率更高，可以在顶点着色器中就完成对光照方向和视角方向的变换
* 另一种选择是在世界空间下进行光照计算，更通用，因为有时我们需要在世界空间下进行一些计算

### 切线空间下计算实战
在切线空间进行光照模型的计算，我们需要知道从模型空间到切线空间的变换矩阵，这个变换矩阵的逆矩阵，即从切线空间到模型空间的变换矩阵是非常容易求得的，因为这个逆矩阵变换就等于它的转置矩阵，因此将顺序按行排列即可

首先在Properties中新增两个属性,_BumpMap凹凸贴图和_BumpScale贴图缩放